# Render Blueprint
# https://render.com/docs/blueprint-spec

services:
  # Backend API Service (FastAPI + CrewAI)
  - type: web
    name: iacuc-protocol-api
    runtime: python
    rootDir: .
    buildCommand: pip install -e .
    startCommand: uvicorn src.api.app:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: ENVIRONMENT
        value: "production"
    healthCheckPath: /health

  # Frontend Static Site (Next.js)
  - type: web
    name: iacuc-protocol-frontend
    runtime: node
    rootDir: frontend
    buildCommand: npm install && NEXT_DISABLE_TURBOPACK=1 npm run build
    startCommand: npm run start
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NEXT_DISABLE_TURBOPACK
        value: "1"
      - key: NEXT_PUBLIC_API_URL
        fromService:
          name: iacuc-protocol-api
          type: web
          property: host
        # Will be set to https://iacuc-protocol-api.onrender.com
        # We append /api/v1 in the frontend code
